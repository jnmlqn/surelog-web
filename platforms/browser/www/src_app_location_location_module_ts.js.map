{"version":3,"sources":["./src/app/location/location-routing.module.ts","./src/app/location/location.module.ts","./src/app/location/location.page.ts","./src/app/location/location.page.scss","./src/app/location/location.page.html"],"names":[],"mappings":"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","file":"src_app_location_location_module_ts.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { LocationPage } from './location.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: LocationPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class LocationPageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { LocationPage } from './location.page';\r\n\r\nimport { LocationPageRoutingModule } from './location-routing.module';\r\n\r\nimport { SharedComponentsModule } from '../components/shared-components.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    LocationPageRoutingModule,\r\n    SharedComponentsModule\r\n  ],\r\n  declarations: [\r\n    LocationPage\r\n  ]\r\n})\r\nexport class LocationPageModule {}\r\n","import { ActivatedRoute } from '@angular/router';\r\nimport { ApiService } from '../services/api/api.service';\r\nimport { Component, OnInit } from '@angular/core';\r\nimport { ControllerService } from '../services/controller/controller.service';\r\nimport { SocketService } from '../services/socket/socket.service';\r\n\r\n@Component({\r\n    selector: 'app-location',\r\n    templateUrl: './location.page.html',\r\n    styleUrls: ['./location.page.scss'],\r\n})\r\nexport class LocationPage implements OnInit {\r\n\r\n    loader: boolean = false;\r\n    project_id: string;\r\n    authorities: any = [];\r\n\r\n    constructor(\r\n        private api: ApiService,\r\n        private controller: ControllerService,\r\n        private route: ActivatedRoute,\r\n        private socket: SocketService,\r\n    ) { }\r\n\r\n    ngOnInit() {\r\n        this.loader = true;\r\n        this.route.params.subscribe(params => {\r\n            this.project_id = params.id;\r\n            this.api.get(`projects/authorities/${this.project_id}`)\r\n            .subscribe(\r\n                (res: any) => {\r\n                    this.loader = false;\r\n                    this.authorities = res.data;\r\n                },\r\n                (err: any) => {\r\n                    this.loader = false;\r\n                    this.controller.showErrorAlert(err);\r\n                }\r\n\r\n            );\r\n        });   \r\n    }\r\n\r\n    locate(authority) {\r\n        let event_count = 0;\r\n        this.controller.presentLoading('Waiting for response, please wait...')\r\n        .then((loading) => {\r\n            let eventTimeout = setTimeout(() => {\r\n                this.controller.presentAlert('Information', 'No response from the project authority device, either the surelog app is not running or the device is not connected to the internet.');\r\n                loading.dismiss();\r\n            }, 10000);\r\n            this.socket.requestLocation(authority.user_id.id, this.project_id);\r\n            this.socket.receiveEvent('send-location')\r\n            .subscribe((data: any) => {\r\n                event_count++;\r\n                clearTimeout(eventTimeout);\r\n                if (event_count == 1) {\r\n                    let ping_data = {\r\n                        project_id: this.project_id,\r\n                        authority_id: authority.user_id.id,\r\n                        location: `${data.latitude},${data.longitude}`\r\n                    }\r\n                    this.api.post('projects/location/store', ping_data)\r\n                    .subscribe(\r\n                        (res: any) => {\r\n                            authority.location = res.data.location;\r\n                            authority.created_at = res.data.created_at;\r\n                            loading.dismiss();\r\n                        },\r\n                        (err: any) => {\r\n                            loading.dismiss();\r\n                            this.controller.showErrorAlert(err);\r\n                        }\r\n                    );\r\n                }\r\n            });\r\n        });\r\n        \r\n    }\r\n}\r\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJsb2NhdGlvbi5wYWdlLnNjc3MifQ== */\";","export default \"<app-navbar [title]=\\\"'LOCATE PROJECT AUTHORITIES'\\\" [loader]=\\\"loader\\\">\\r\\n    <div content>\\r\\n        Browse Project Authorities\\r\\n        <br><br>\\r\\n        <div style=\\\"overflow: auto\\\">\\r\\n            <table class=\\\"table table-hover table-borderless data-table\\\">\\r\\n                <thead>\\r\\n                    <tr>\\r\\n                        <th class=\\\"text-muted\\\">\\r\\n                            Project Authority Name\\r\\n                        </th>\\r\\n                        <th class=\\\"text-muted\\\">\\r\\n                            Last detected location\\r\\n                        </th>\\r\\n                        <th class=\\\"text-muted\\\">\\r\\n                            Last updated at\\r\\n                        </th>\\r\\n                        <th class=\\\"center text-muted\\\">\\r\\n                            Locate\\r\\n                        </th>\\r\\n                    </tr>\\r\\n                </thead>\\r\\n                <tbody>\\r\\n                    <tr *ngFor=\\\"let authority of authorities\\\" class=\\\"bg-light data-row\\\">\\r\\n                        <th>{{authority.user_id.name}}</th>\\r\\n                        <th>\\r\\n                            <a href=\\\"{{authority.location}}\\\" *ngIf=\\\"authority.location !== null\\\" target=\\\"_blank\\\">Click to view location</a>\\r\\n                            <span *ngIf=\\\"authority.location == null\\\">N/A</span>\\r\\n                        </th>\\r\\n                        <th>\\r\\n                            <span *ngIf=\\\"authority.created_at !== null\\\">{{authority.created_at | date: 'medium'}}</span>\\r\\n                            <span *ngIf=\\\"authority.created_at == null\\\">N/A</span>\\r\\n                        </th>\\r\\n                        <th class=\\\"center\\\">\\r\\n                            <span class=\\\"pointer text-success\\\" title=\\\"Locate\\\" style=\\\"font-size: 1.5em;\\\" (click)=\\\"locate(authority)\\\">\\r\\n                                <ion-icon name=\\\"locate-outline\\\"></ion-icon>\\r\\n                            </span>\\r\\n                        </th>\\r\\n                    </tr>\\r\\n                </tbody>\\r\\n            </table>\\r\\n        </div>\\r\\n    </div>\\r\\n</app-navbar>\";"],"sourceRoot":"webpack:///"}